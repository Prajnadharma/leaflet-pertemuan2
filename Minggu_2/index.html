<!DOCTYPE html>
<html>
<head>
  <title>Tugas 2 - Route, Polyline, Polygon, Marker</title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />

  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

  <!-- Leaflet Routing Machine -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine/dist/leaflet-routing-machine.css" />
  <script src="https://unpkg.com/leaflet-routing-machine/dist/leaflet-routing-machine.js"></script>

  <style>
    #map { height: 100vh; }
    .legend {
      background: white;
      padding: 8px;
      line-height: 1.5em;
      border-radius: 5px;
      box-shadow: 0 0 5px rgba(0,0,0,0.3);
    }
    .legend i {
      width: 20px;
      height: 10px;
      float: left;
      margin-right: 8px;
      opacity: 0.9;
    }
    .leaflet-popup-content {
      white-space: normal;
    }
    .custom-icon {
      border-radius: 50%;
      background: white;
      border: 2px solid #333;
    }
  </style>
</head>
<body>
  <div id="map"></div>

  <script>
    var map = L.map('map').setView([-8.65, 115.30], 11);

    var osm = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '© OpenStreetMap'
    }).addTo(map);

    var esriSat = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
      attribution: '© Esri'
    });

    var markerGroup = L.layerGroup().addTo(map);
    var polygonGroup = L.layerGroup().addTo(map);
    var polylineGroup = L.layerGroup().addTo(map);

    // Fungsi Custom Marker
    function customMarker(lat, lng, imgUrl, title, address) {
      var icon = L.icon({
        iconUrl: imgUrl,
        iconSize: [50, 50],
        className: 'custom-icon',
        popupAnchor: [0, -10]
      });
      return L.marker([lat, lng], {icon: icon})
        .bindPopup("<b>" + title + "</b><br>" + address, {maxWidth: 400});
    }

    // Marker
    var sma2 = customMarker(-8.526823,115.399481,
      "https://www.smadara.sch.id/sites/default/files/gajah.jpg",
      "SMA Negeri 2 Semarapura",
      "Jl. Dewi Sartika, Semarapura Kaja, Kec. Klungkung, Kabupaten Klungkung, Bali 80711");

    var rumah = customMarker(-8.545958,115.400083,
      "https://media.licdn.com/dms/image/v2/D4D03AQFdv8yE20poeA/profile-displayphoto-shrink_800_800/profile-displayphoto-shrink_800_800/0/1718232958917?e=1761782400&v=beta&t=8OoKo2saYhjswCR8fCLJH1kSKYgFMu1YL91yUlPWsGU",
      "Rumah Saya",
      "Jl. Kenyeri VII Semarapura Kelod, Klungkung, Klungkung Regency, Bali 80716");

    var perpustakaan = customMarker(-8.799009,115.172810,
      "https://e-perpus.unud.ac.id/uploads/file_konten_dir/2085556d5f34da075faceb7ad311becf.jpg",
      "Perpustakaan Universitas Udayana",
      "652F+95R Kampus Bukit, Jimbaran, Kec. Kuta Sel., Kabupaten Badung, Bali 80361");

    var gedungTI = customMarker(-8.796370,115.176336,
      "https://pbs.twimg.com/profile_images/1196271602469462017/G8B97r0C_400x400.jpg",
      "Gedung Prodi Teknologi Informasi, Fakultas Teknik, Universitas Udayana",
      "653G+CGQ, Jl. Raya Kampus Udayana, Jimbaran, Kec. Kuta Sel., Kabupaten Badung, Bali 80361");

    var kantin = customMarker(-8.795437,115.176426,
      "https://awsimages.detik.net.id/community/media/visual/2020/01/16/dadf5fe4-cbaf-444c-a6a4-fa05db8174d7_169.jpeg?w=1200",
      "Kantin Teknik",
      "Lingkungan Fakultas Teknik, Universitas Udayana, Jl. Raya Kampus Udayana, Jimbaran");

    var kelurahan = customMarker(-8.539060,115.401094,
      "https://streetviewpixels-pa.googleapis.com/v1/thumbnail?panoid=jq1ew3KFAjfdRT_mUDtzZQ&cb_client=search.gws-prod.gps&w=408&h=240&yaw=5.6149626&pitch=0&thumbfov=100",
      "Kelurahan Semarapura Kelod",
      "Jl. Jempiring No.10, Semarapura Kelod, Kec. Klungkung, Kabupaten Klungkung, Bali 80761");

    var lapangan = customMarker(-8.5358,115.4019,
      "https://www.balipost.com/wp-content/uploads/2018/01/balipostcom_akan-ditata-lapangan-puputan-dan-pantai-goa-lawah-dianggarkan-rp-98-miliar_01.jpg",
      "Lapangan Puputan Klungkung",
      "Jl. Untung Suropati No.25, Semarapura Kelod, Kec. Klungkung, Kabupaten Klungkung, Bali 80711");

    var parkiran = customMarker(-8.7956,115.1761,
      "https://www.persakademika.com/wp-content/uploads/2024/04/20240404_165554-scaled.jpg",
      "Parkiran Teknik",
      "Lingkungan Fakultas Teknik, Universitas Udayana, Jl. Raya Kampus Udayana, Jimbaran");

    markerGroup.addLayer(rumah);
    markerGroup.addLayer(sma2);
    markerGroup.addLayer(kelurahan);
    markerGroup.addLayer(gedungTI);
    markerGroup.addLayer(kantin);
    markerGroup.addLayer(perpustakaan);
    markerGroup.addLayer(lapangan);
    markerGroup.addLayer(parkiran);

    // POLYGON Lapangan
    var lapanganPoly = L.polygon([
      [-8.535107,115.401243],
      [-8.535287,115.402398],
      [-8.536488,115.402308],
      [-8.536263,115.401016]
    ], {color: 'orange', fillOpacity: 0.4}).addTo(polygonGroup);

    // POLYGON Parkiran
    var parkiranPoly = L.polygon([
      [-8.795516, 115.176185],
      [-8.795501, 115.176002],
      [-8.795591, 115.175976],
      [-8.795644, 115.175852],
      [-8.795755, 115.175815],
      [-8.795824, 115.176094]
    ], {color: 'brown', fillOpacity: 0.4}).addTo(polygonGroup);

    // ROUTE Online → masuk polylineGroup
    function addRoute(start, end, color, title) {
      var control = L.Routing.control({
        waypoints: [L.latLng(start[0], start[1]), L.latLng(end[0], end[1])],
        lineOptions: { styles: [{ color: color, weight: 5 }] },
        createMarker: function () { return null; },
        addWaypoints: false,
        draggableWaypoints: false,
        fitSelectedRoutes: false,
        show: false
      }).addTo(map);

      control.on('routesfound', function(e) {
        var route = e.routes[0];
        var coords = route.coordinates;
        var customRoute = L.polyline(coords, { color: color, weight: 5 });
        customRoute.bindPopup("<b>"+title+"</b><br>Jarak: " 
          + (route.summary.totalDistance / 1000).toFixed(2) + " km<br>" +
          "Waktu: " + Math.round(route.summary.totalTime / 60) + " menit", {maxWidth: 400});
        customRoute.addTo(polylineGroup);
        map.removeControl(control);
      });
    }

    addRoute([-8.545958,115.400083], [-8.526823,115.399481], "orange", "Rumah → SMA 2 Semarapura");
    addRoute([-8.545958,115.400083], [-8.539060,115.401094], "green", "Rumah → Kelurahan Semarapura Kelod");
    addRoute([-8.545958,115.400083], [-8.796370,115.176336], "red", "Rumah → Gedung TI");

    // POLYLINE Manual
    var poly1 = L.polyline([
      [-8.796301, 115.176233],
      [-8.795951, 115.176271],
      [-8.795840, 115.175766],
      [-8.795617, 115.175825],
      [-8.795575, 115.175976],
      [-8.795458, 115.175992],
      [-8.795474, 115.176410]
    ], {color: "blue"}).bindPopup("Polyline TI → Kantin", {maxWidth: 400}).addTo(polylineGroup);

    var poly2 = L.polyline([
      [-8.796301, 115.176233],
      [-8.796306, 115.175997],
      [-8.796349, 115.175890],
      [-8.796290, 115.175525],
      [-8.795797, 115.175681],
      [-8.795739, 115.175638],
      [-8.797298, 115.175144],
      [-8.797483, 115.174903],
      [-8.797573, 115.174554],
      [-8.797462, 115.173277],
      [-8.797907, 115.173047],
      [-8.798411, 115.173052],
      [-8.798544, 115.172950],
      [-8.798819, 115.172945],
      [-8.798952, 115.172719],
      [-8.799116, 115.172762],
      [-8.799227, 115.172682]
    ], {color: "purple"}).bindPopup("Polyline TI → Perpustakaan", {maxWidth: 400}).addTo(polylineGroup);

    // Layer Control
    var baseMaps = {
      "OpenStreetMap": osm,
      "Esri Satellite": esriSat
    };

    var overlayMaps = {
      "Markers": markerGroup,
      "Polygon": polygonGroup,
      "Polyline (Manual + Route)": polylineGroup
    };

    L.control.layers(baseMaps, overlayMaps).addTo(map);

    // Legenda
    var legend = L.control({position: 'bottomright'});
    legend.onAdd = function (map) {
      var div = L.DomUtil.create('div', 'legend');
      div.innerHTML += "<b>Legenda</b><br>";
      div.innerHTML += '<i style="background:orange"></i> Rumah Saya → SMA 2 Semarapura<br>';
      div.innerHTML += '<i style="background:green"></i> Rumah Saya → Kelurahan<br>';
      div.innerHTML += '<i style="background:red"></i> Rumah Saya → Gedung TI<br>';
      div.innerHTML += '<i style="background:blue"></i> Polyline TI → Kantin Teknik<br>';
      div.innerHTML += '<i style="background:purple"></i> Polyline TI → Perpustakaan<br>';
      div.innerHTML += '<i style="background:brown"></i> Polygon Parkiran Teknik<br>';
      div.innerHTML += '<i style="background:orange"></i> Polygon Lapangan Puputan Klungkung<br>';
      return div;
    };
    legend.addTo(map);

  </script>
</body>
</html>
